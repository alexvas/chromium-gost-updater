#!/usr/bin/make -f

%:
	dh $@ --with python3

override_dh_auto_install:
	# Устанавливаем файлы вручную
	install -d $(CURDIR)/debian/chromium-gost-updater/usr/bin
	install -m 755 chromium-gost-updater.py $(CURDIR)/debian/chromium-gost-updater/usr/bin/
	install -m 755 chromium-gost-updater-wrapper.sh $(CURDIR)/debian/chromium-gost-updater/usr/bin/
	
	install -d $(CURDIR)/debian/chromium-gost-updater/usr/lib/systemd/user
	# Используем системный вариант service файла с путем /usr/bin/
	@if [ -f chromium-gost-updater.service.system ]; then \
		install -m 644 chromium-gost-updater.service.system $(CURDIR)/debian/chromium-gost-updater/usr/lib/systemd/user/chromium-gost-updater.service; \
	else \
		sed 's|%h/.local/bin/chromium-gost-updater-wrapper.sh|/usr/bin/chromium-gost-updater-wrapper.sh|' chromium-gost-updater.service > $(CURDIR)/debian/chromium-gost-updater/usr/lib/systemd/user/chromium-gost-updater.service; \
		chmod 644 $(CURDIR)/debian/chromium-gost-updater/usr/lib/systemd/user/chromium-gost-updater.service; \
	fi
	install -m 644 chromium-gost-remote.timer $(CURDIR)/debian/chromium-gost-updater/usr/lib/systemd/user/
	
	install -d $(CURDIR)/debian/chromium-gost-updater/usr/share/chromium-gost-updater
	install -m 644 chromium-gost-logo.png $(CURDIR)/debian/chromium-gost-updater/usr/share/chromium-gost-updater/
	install -m 644 chromium-gost-updater.toml $(CURDIR)/debian/chromium-gost-updater/usr/share/chromium-gost-updater/
	
	install -d $(CURDIR)/debian/chromium-gost-updater/usr/share/doc/chromium-gost-updater
	install -m 644 README.md $(CURDIR)/debian/chromium-gost-updater/usr/share/doc/chromium-gost-updater/
	install -m 644 NOTICE.txt $(CURDIR)/debian/chromium-gost-updater/usr/share/doc/chromium-gost-updater/

override_dh_python3:
	# Не устанавливаем как Python модуль, устанавливаем как скрипт
	:

